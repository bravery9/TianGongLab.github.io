<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Server as Client 漏洞模型 | 破壳漏洞挖掘平台</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://poc.qianxin.com/img/poc-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://poc.qianxin.com/img/poc-social-card.jpg"><meta data-rh="true" property="og:url" content="https://poc.qianxin.com/blog/tiangongarticle015"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Server as Client 漏洞模型 | 破壳漏洞挖掘平台"><meta data-rh="true" name="description" content="一、前言"><meta data-rh="true" property="og:description" content="一、前言"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-01-16T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Vulnerability Pattern"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://poc.qianxin.com/blog/tiangongarticle015"><link data-rh="true" rel="alternate" href="https://poc.qianxin.com/blog/tiangongarticle015" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://poc.qianxin.com/blog/tiangongarticle015" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://M80RFF4T9F-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="破壳漏洞挖掘平台 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="破壳漏洞挖掘平台 Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="破壳漏洞挖掘平台" href="/opensearch.xml">
<script src="https://www.clarity.ms/tag/k257lj4y58"></script>
<script src="https://hm.baidu.com/hm.js?bd805f6d9db85a795e91b7f0e7038239" async></script><link rel="stylesheet" href="/assets/css/styles.88d55d52.css">
<script src="/assets/js/runtime~main.2212ea34.js" defer="defer"></script>
<script src="/assets/js/main.9180fd70.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://poc.qianxin.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="破壳文档" class="nav-logo-class themedComponent_mlkZ themedComponent--light_NVdE" height="20" width="100"><img src="/img/logo.svg" alt="破壳文档" class="nav-logo-class themedComponent_mlkZ themedComponent--dark_xIcU" height="20" width="100"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link tutorialClass" href="/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog/tags">标签</a><a class="navbar__item navbar__link" href="/blog/archive">归档</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://poc.qianxin.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">破壳官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle018">WebAssembly安全研究总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle017">Terrapin 攻击分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle016">常见 PHP 源码保护与还原</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/tiangongarticle015">Server as Client 漏洞模型</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle014">破壳分析：Linksys设备多个0-day漏洞</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle013">ESXi SLP漏洞复现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle012">从传统到 AI 探讨 Webshell 检测攻防对抗</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle011">人与代码的桥梁-聊聊SAST</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle010">BMC 漏洞实例分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle009">CodeDom 漏洞模式与 SharePoint RCE</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle008">Datacon 2023 漏洞分析赛道赛题二官方题解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle007">IoT 设备中的认证绕过漏洞分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle006">Exchange Server(CVE-2023-36439)远程代码执行漏洞分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle005">WAF防护绕过技巧分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle004">伪随机数问题浅析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle003">Windows内核竞态条件漏洞研究</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle002">Microsoft Hyper-V 虚拟 TPM 设备漏洞分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle001">CVE-2023-0179 Linux内核提权</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="一、前言"><header><h1 class="title_f1Hy" itemprop="headline">Server as Client 漏洞模型</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-01-16T00:00:00.000Z" itemprop="datePublished">2024年1月16日</time> · <!-- -->阅读需 17 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://tiangonglab.github.io/img/authors/l1nk.jpg" alt="l1nk" itemprop="image"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">l1nk</span></div><small class="avatar__subtitle" itemprop="description">Datacon 2023 出题人，主攻二进制漏洞挖掘</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一前言">一、前言<a href="#一前言" class="hash-link" aria-label="一、前言的直接链接" title="一、前言的直接链接">​</a></h2>
<p>在漏洞挖掘工作中，攻击面的选择往往是一个非常重要的环节，一些意想不到的攻击面中往往存在大量开发测试人员疏忽的点。本文就关于一种有趣的攻击面进行探讨，将其起名为SaC（Server as Client）。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二client-server-架构">二、Client Server 架构<a href="#二client-server-架构" class="hash-link" aria-label="二、Client Server 架构的直接链接" title="二、Client Server 架构的直接链接">​</a></h2>
<p>在带有网络通信的传统软件开发过程中，往往会使用一种叫做CS（Client Server）的架构，这个架构模型大致上是由提供服务的服务端（Server）以及请求服务资源的客户端（Client）组成。</p>
<p><img loading="lazy" src="/assets/images/aa707eea-77ac-4480-bb99-3318253b20f1-c36970820c6f1f0b36724aa155c26da4.png" width="506" height="303" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-cs架构的特征">2.1 CS架构的特征<a href="#21-cs架构的特征" class="hash-link" aria-label="2.1 CS架构的特征的直接链接" title="2.1 CS架构的特征的直接链接">​</a></h3>
<p>服务端通常来说，具有如下的特点：</p>
<ul>
<li>具有高权限。为了方便的进行资源调度，权限控制等任务，大多数的服务端程序会以相当高的权限运行在机器上。</li>
<li>可能为分布式。服务端为了减轻请求处理的压力，有时候会将服务以微服务部署在多个服务器上，或者在多个机器上部署的同时，使用调度工具对请求进行调度。</li>
<li>持续监听，对请求反馈。服务端大多数为持续监听一个固定的对象，比如固定的某些端口，从而保证能够随时处理来自客户端的请求。</li>
<li>对请求进行校验，防护完善。由于要对请求进行鉴权，所以有着更加严格的访问控制；同时由于服务端存放大量资源，一般会有非常严格的检查</li>
</ul>
<p>而相对于服务端，客户端往往具有如下的特点：</p>
<ul>
<li>不一定为高权限进程。由于客户端往往只是请求某些资源，这个过程大多数情况下无需高权限访问。</li>
<li>每次访问只维护单个会话。客户端的每次资源请求大多数只建立一次会话，不存在同时发起多个会话的情况。</li>
<li>通常请求单个服务端资源。虽然客户端可能会请求多种不同类型的资源，但是每次请求基本上都有某一个固定的服务端进行响应处理。</li>
<li>防护相对不到位。由于客户端本质上运行在客户机器上，加之运行权限不高，一般不会有特别复杂的防护机制</li>
</ul>
<table><thead><tr><th>Server</th><th>Client</th></tr></thead><tbody><tr><td>权限通常较高</td><td>权限通常不高</td></tr><tr><td>可能为分布式</td><td>单个端点请求资源</td></tr><tr><td>持续性监听</td><td>单个会话访问</td></tr><tr><td>安全校验严格</td><td>防护较为松散</td></tr></tbody></table>
<p>而这类架构往往又具有如下的特点：</p>
<ul>
<li>双方在同一网络内</li>
<li>请求由客户端发起，服务器端进行接受</li>
<li>服务端具有大量的防护机制，包括但不限于<!-- -->
<ul>
<li>权限控制</li>
<li>数据安全边界检查</li>
<li>软  件本身代码安全标准高</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三漏洞模型分析">三、漏洞模型分析<a href="#三漏洞模型分析" class="hash-link" aria-label="三、漏洞模型分析的直接链接" title="三、漏洞模型分析的直接链接">​</a></h2>
<p>对于攻击者而言，大多数情况下服务端的资源为攻击目标，因此大部分的时候攻击都针对服务端发起，服务端也就在攻防对抗中逐渐加固；而客户端由于价值低，通常缺乏这类攻防事件，相对来说受到的攻击较少。那么，此时只要创建出一个场景，让服务端变为客户端，则此时服务端中存在的客户端的攻击面就会暴露出来，从而造成大量危害。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-server-as-client">3.1 Server as Client<a href="#31-server-as-client" class="hash-link" aria-label="3.1 Server as Client的直接链接" title="3.1 Server as Client的直接链接">​</a></h3>
<p>大多数情况下，服务端程序并不会仅仅作为提供资源的一方存在。在现代模型中，单个服务器能够完成的功能有限，在特定的情境下，服务端也会作为客户端向其他的服务端进行资源请求，例如如下的场景：</p>
<ul>
<li>访问不存在本服务器的资源</li>
<li>远程路径访问</li>
<li>RPC调用</li>
<li>代理访问</li>
</ul>
<p>当服务端A去向服务端B发起请求的时候，此时的服务端A本质上是作为客户端存在的，此时的服务端身份就转换成了客户端。而客户端往往是防护较为薄弱的一环，服务端上的客户端部分也是如此。</p>
<p>这类攻击往往需要构造如下的场景：</p>
<ul>
<li>攻击者需要具有两台机器，一台攻击机（Hacker），以及受控的另一台伪造服务端（Fake Server）；</li>
<li>某些场景下，受控的伪造服务端要和受害主机（Victim Server）在同一个内网中。</li>
</ul>
<p><img loading="lazy" src="/assets/images/6d3a79e4-4145-4bea-ae95-8f3fe6df49ba-43d68b8535b706293016c047ef0f2bef.png" width="862" height="340" class="img_ev3q"></p>
<p>此时，可以通过在Fake Server 上构造畸形的数据包，从而实现对受害主机的攻击。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="四实例cve-2021-43893">四、实例：CVE-2021-43893<a href="#四实例cve-2021-43893" class="hash-link" aria-label="四、实例：CVE-2021-43893的直接链接" title="四、实例：CVE-2021-43893的直接链接">​</a></h2>
<p>漏洞<code>CVE-2021-43893</code>为 Windows 上的<code>EFSRPC</code>服务，主要用于提供在远程服务器上进行数据的加解密。微软在修复漏洞的时候，存在疏忽，导致这个漏洞的生命周期中经历了如下两个阶段：</p>
<ul>
<li>（漏洞一）最初漏洞本身通过直接窃取<code>Net-NTML</code>，从而实现<code>NTML-Relay</code>。</li>
<li>（漏洞二）微软对其进行了简单的修复后，并未完全封堵，导致该漏洞可变形为未授权用户往Windows Server上传任意文件。</li>
</ul>
<p>接下来会对两种漏洞的成因以及利用进行分析。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-漏洞一成因">4.1 漏洞一成因<a href="#41-漏洞一成因" class="hash-link" aria-label="4.1 漏洞一成因的直接链接" title="4.1 漏洞一成因的直接链接">​</a></h3>
<p>首先检查函数原型:</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">EfsRpcOpenFileRaw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token class-name">handle_t</span><span class="token plain"> binding_h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> PEXIMPORT_CONTEXT_HANDLE</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> hContext</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token class-name">wchar_t</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> FileName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> Flags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该函数的作用为一个RPC接口，用于打开位于RPC服务端的一个文件。这里的<code>FileName</code>根据MSDN的定义，可以支持<code>UncPath</code>。</p>
<p>通常来说，目标服务端会指定一个目录，例如：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D:\ShareFiles</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时，这个目录会作为远程访问服务端的用户根目录，用户可以访问这个目录下的一些共享文件。</p>
<p>当用户访问远程服务端的时候，用户所在的客户端会使用本地的<code>EFSRPC</code>服务尝试调用服务器端的RPC接口，此时通过RPC，会调用服务端上的<code>EfsRpcOpenFileRaw</code>这类函数，这里的<code>FileName</code>为UNC路径，本意上为开发者想要兼容各类路径想到的，比如我们可以把<code>FileName</code>写成一些远程服务器上的路径，这样即使本机没有，我们也能要求服务端去访问远程文件：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">\\10.1.0.1\file </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然而这个远程调用没有表面看上去这么简单，假设这个<code>10.1.0.1</code> IP 对应的机器为我们可控的情况下，会发现<code>EfsRpcOpenFileRaw</code>这个API为了能够进行认证， 会尝试在发起获取远程文件的请求时，将当前服务端的 <code>Net-NTLM</code> 发送给<code>10.1.0.1</code>。而由于此时的<code>10.1.0.1</code> 为我们假冒的，因此我们可以轻易的截获<code>Net-NTLM</code>。一旦获取受害机器的<code>Net-NTLM</code>，我们就能够使用这个值去伪装认证，最终将自己伪装成受害机器。具体来说流程如下：</p>
<p><img loading="lazy" src="/assets/images/a33370c7-c429-4391-a8d3-182783e212eb-ba9976569dd5fe0b837863fe3c6ef49e.png" width="856" height="659" class="img_ev3q"></p>
<p>这种泄露<code>Net-NTLM</code>的具体利用细节可以参考<a href="https://forum.butian.net/share/2087" target="_blank" rel="noopener noreferrer">这里的文章</a>，最终效果便是能够作为受害主机的权限，在内网中进行资源访问。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-漏洞二成因">4.2 漏洞二成因<a href="#42-漏洞二成因" class="hash-link" aria-label="4.2 漏洞二成因的直接链接" title="4.2 漏洞二成因的直接链接">​</a></h3>
<p>微软意识到这个问题后，给 EFSRPC 服务的对应API增加了身份认证，这样当我们访问远程机器的时候，首先要进行身份认证，这就限制了使用这个问题进行远程访问的问题（虽然在此期间，微软拉扯了很多次，导致漏洞修复的比较缓慢，这就是后话了）。</p>
<p>但是又有新的安全人员根据这个漏洞受到启发。原先在<code>EfsRpcOpenFileRaw</code>这类函数使用的时候，会检查路径的权限，例如显然是不允许访问服务端的<code>C:</code>这个目录的，但是为了支持远程路径，在遇到<code>\</code>开头的路径时，一律按照远程文件访问处理，这就导致其忘记检查形如<code>\\.\C:</code>的路径，这种形式的写法本质上还是在访问本地磁盘，从而导致这个API可以存在一个路径穿越问题。</p>
<p>这个漏洞的使用范围会比上一个小很多，因为  这种情况下，RPC接口会保证我们的请求是在低权限下执行，但是通过<a href="https://www.rapid7.com/blog/post/2022/02/14/dropping-files-on-a-domain-controller-using-cve-2021-43893/" target="_blank" rel="noopener noreferrer">一些技巧</a>，我们也是有机会提权的，具体可直接参考文章。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-cve-2021-43893-引发的思考">4.3 CVE-2021-43893 引发的思考<a href="#43-cve-2021-43893-引发的思考" class="hash-link" aria-label="4.3 CVE-2021-43893 引发的思考的直接链接" title="4.3 CVE-2021-43893 引发的思考的直接链接">​</a></h3>
<p>通过学习这个漏洞，我们能够收获如下的启发：</p>
<ul>
<li>软件中同样存在着类似web安全中的SSRF问题，同样有可能实现越权访问</li>
<li>服务端程序在某些特定的请求下，会转换成客户端请求</li>
<li>客户端部分在实现的时候，安全性往往不如服务端严格</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="五实例cve-2022-26809">五、实例：CVE-2022-26809<a href="#五实例cve-2022-26809" class="hash-link" aria-label="五、实例：CVE-2022-26809的直接链接" title="五、实例：CVE-2022-26809的直接链接">​</a></h2>
<p>上个漏洞中提及了RPC服务，于是有很多安全人员开始进一步的研究RPC协议调用过程中会发生的问题，并且发现了其中的一些问题。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51-rpc简介">5.1 RPC简介<a href="#51-rpc简介" class="hash-link" aria-label="5.1 RPC简介的直接链接" title="5.1 RPC简介的直接链接">​</a></h3>
<p>RPC全程为远程过程调用（Remote Procedure Call），分为Server端和Client端。其调用模式如图：</p>
<p><img loading="lazy" src="data:image/png;base64,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" width="263" height="221" class="img_ev3q"></p>
<p>有些场景我们希望某些功能在指定的服务端实现，例如上个例子中的文件共享，此时我们会希望相关的逻辑是现在服务端上，而客户端使用API直接请求对应的数据，这个时候就能够使用RPC来完成我们的功能。</p>
<p>RPC有点类似现在的web服务，其也分为客户端和服务端。简单来说，这两者在RPC中主要作用如下：</p>
<p>服务端：</p>
<ul>
<li>将被调用的函数绑定到服务中</li>
<li>将自己注册到RPC管理器中</li>
<li>处理来自客户端的请求</li>
</ul>
<p>客户端：</p>
<ul>
<li>申请使用RPC调用</li>
<li>向服务端发起请求，并且调用对应的API</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52-漏洞介绍">5.2 漏洞介绍<a href="#52-漏洞介绍" class="hash-link" aria-label="5.2 漏洞介绍的直接链接" title="5.2 漏洞介绍的直接链接">​</a></h3>
<p>这个漏洞出现在RPC的客户端逻辑中，在函数<code>OSF_CASSOCIATION::ProcessBindAckOrNak</code>中存在这样的逻辑：</p>
<p><img loading="lazy" src="/assets/images/adbc9038-3fd5-49bd-8a20-b164d8b1fd9b-3bc7c93c259ea707c46231e6986411d1.png" width="1131" height="383" class="img_ev3q"></p>
<p>这里的<code>BufferLength</code>为我们传入的Buffer长度，根据逆向分析后可以知道，RPC结构体分为两部分: Header和Body，其中根据收到的回复类型的不同，RPC会使用不同类型的Header，一般来说分为其中两种：</p>
<ul>
<li><code>bind_ack</code>: 接受RPC调用，包头部长度为26字节。</li>
<li><code>alter_context_resp</code>: RPC调用发生变化，重新进行握手等动作，包头部长度为26字节。<strong>存在额外数据。</strong></li>
</ul>
<p>根据分析可知，虽然上述的Header长度一致，但是<code>alter_context_resp</code>会额外包含一些数据，所以在计算body位置的时候，<strong>会多减去两个字节</strong>。而上述代码中， 程序只做了如下的检查</p>
<ul>
<li>数据包长度至少为26字节（代码中未展示）</li>
<li>接受的数据包是否为<code>bind_ack</code>，计算body的长度</li>
</ul>
<p>可以看到，这里并没有确保收到的数据包一定是来自于<code>alter_context_resp</code>这种类型。于是当我们此时申明我们数据包来自<code>alter_context_resp</code>，但是长度仅为26字节的时候，即可通过上述的检查，而代码中这里就存在一个可以造成整数溢出的点。</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bodyLength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BufferLength </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// BufferLength可以只为26</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    offset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">i64</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53-漏洞场景">5.3 漏洞场景<a href="#53-漏洞场景" class="hash-link" aria-label="5.3 漏洞场景的直接链接" title="5.3 漏洞场景的直接链接">​</a></h3>
<p>这个漏洞是在收到回复包的情况下触发，所以正常的发包是无法进入对应的逻辑中的，但是我们可以通过如下的方式诱发漏洞：</p>
<p><img loading="lazy" src="/assets/images/8a618980-f192-4068-85b5-75356a17ab8e-0e5ac6e5bb5156ad4dc8a6081702e801.png" width="675" height="541" class="img_ev3q"></p>
<p>同样，此漏洞也需要通过伪造服务端来实现漏洞的诱发。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="六模型总结">六、模型总结<a href="#六模型总结" class="hash-link" aria-label="六、模型总结的直接链接" title="六、模型总结的直接链接">​</a></h2>
<p>上述的例子中，不但出现了狭义上的客户端，即单纯的向服务端请求数据，并且对数据进行接收的模块，还出现了广义上的客户端，也就是自己发起请求后，接受对端的回应数据包。</p>
<p>在漏洞挖掘过程中，广义上的客户端往往会成为人们忽略的要点。就像是RPC漏洞中，用于处理ACK数据包的模块。从直觉上理解，ACK数据包一定是来自于不受控的服务端，但是在实际攻击场景中，服务端本身也是允许伪造的，此时处理ACK数据包的处理端就能视为成客户端。</p>
<p>基于上述思路，我们可以列举出一些常见的场景:</p>
<ul>
<li>文件共享的时候，负责接受文件的客户端</li>
<li>代理访问，进行代理确认的代理端</li>
<li>加密操作时，负责接受加密数据的接收端</li>
<li>负责接受邮件的邮件客户端</li>
</ul>
<p>在上述场景中，大多数的场景会被我们忽略，因为常理上讲，无法对目标造成损失——毕竟这些操作通常发生在我们自己的机器上，而执行操作的进程大概率也不是高权限进程。然而，通过远程路径访问，代理转发，以及对端加密，或者以服务存在的高权限邮件对邮件进行解析等操作，是具备将这些客户端漏洞转化为高价值漏洞的。在进行软件安全性分析的时候，不妨以这些面为切入点，也能找到一些有趣的漏洞。</p>
<p><img loading="lazy" src="/assets/images/4609ab53-6284-41ee-8f5d-d85300af9a19-4867b7388101c04c3de8093befef8698.png" width="812" height="882" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/vulnerability-pattern">Vulnerability Pattern</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/TianGongLab/poc_docs/tree/main/blog/2024-01-16-server-as-client/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/tiangongarticle016"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">常见 PHP 源码保护与还原</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tiangongarticle014"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">破壳分析：Linksys设备多个0-day漏洞</div></a></nav><div style="margin-top:20px"></div></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一前言" class="table-of-contents__link toc-highlight">一、前言</a></li><li><a href="#二client-server-架构" class="table-of-contents__link toc-highlight">二、Client Server 架构</a><ul><li><a href="#21-cs架构的特征" class="table-of-contents__link toc-highlight">2.1 CS架构的特征</a></li></ul></li><li><a href="#三漏洞模型分析" class="table-of-contents__link toc-highlight">三、漏洞模型分析</a><ul><li><a href="#31-server-as-client" class="table-of-contents__link toc-highlight">3.1 Server as Client</a></li></ul></li><li><a href="#四实例cve-2021-43893" class="table-of-contents__link toc-highlight">四、实例：CVE-2021-43893</a><ul><li><a href="#41-漏洞一成因" class="table-of-contents__link toc-highlight">4.1 漏洞一成因</a></li><li><a href="#42-漏洞二成因" class="table-of-contents__link toc-highlight">4.2 漏洞二成因</a></li><li><a href="#43-cve-2021-43893-引发的思考" class="table-of-contents__link toc-highlight">4.3 CVE-2021-43893 引发的思考</a></li></ul></li><li><a href="#五实例cve-2022-26809" class="table-of-contents__link toc-highlight">五、实例：CVE-2022-26809</a><ul><li><a href="#51-rpc简介" class="table-of-contents__link toc-highlight">5.1 RPC简介</a></li><li><a href="#52-漏洞介绍" class="table-of-contents__link toc-highlight">5.2 漏洞介绍</a></li><li><a href="#53-漏洞场景" class="table-of-contents__link toc-highlight">5.3 漏洞场景</a></li></ul></li><li><a href="#六模型总结" class="table-of-contents__link toc-highlight">六、模型总结</a></li></ul></div></div></div></div></div></div>
</body>
</html>
<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">WAF防护绕过技巧分析 | 破壳漏洞挖掘平台</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://poc.qianxin.com/img/poc-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://poc.qianxin.com/img/poc-social-card.jpg"><meta data-rh="true" property="og:url" content="https://poc.qianxin.com/blog/tiangongarticle005"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="WAF防护绕过技巧分析 | 破壳漏洞挖掘平台"><meta data-rh="true" name="description" content="一、WAF介绍与分类"><meta data-rh="true" property="og:description" content="一、WAF介绍与分类"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-11-08T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="WAF"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://poc.qianxin.com/blog/tiangongarticle005"><link data-rh="true" rel="alternate" href="https://poc.qianxin.com/blog/tiangongarticle005" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://poc.qianxin.com/blog/tiangongarticle005" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://M80RFF4T9F-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="破壳漏洞挖掘平台 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="破壳漏洞挖掘平台 Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="破壳漏洞挖掘平台" href="/opensearch.xml">
<script src="https://www.clarity.ms/tag/k257lj4y58"></script>
<script src="https://hm.baidu.com/hm.js?bd805f6d9db85a795e91b7f0e7038239" async></script><link rel="stylesheet" href="/assets/css/styles.88d55d52.css">
<script src="/assets/js/runtime~main.2212ea34.js" defer="defer"></script>
<script src="/assets/js/main.9180fd70.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://poc.qianxin.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="破壳文档" class="nav-logo-class themedComponent_mlkZ themedComponent--light_NVdE" height="20" width="100"><img src="/img/logo.svg" alt="破壳文档" class="nav-logo-class themedComponent_mlkZ themedComponent--dark_xIcU" height="20" width="100"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link tutorialClass" href="/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog/tags">标签</a><a class="navbar__item navbar__link" href="/blog/archive">归档</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://poc.qianxin.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">破壳官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle018">WebAssembly安全研究总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle017">Terrapin 攻击分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle016">常见 PHP 源码保护与还原</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle015">Server as Client 漏洞模型</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle014">破壳分析：Linksys设备多个0-day漏洞</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle013">ESXi SLP漏洞复现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle012">从传统到 AI 探讨 Webshell 检测攻防对抗</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle011">人与代码的桥梁-聊聊SAST</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle010">BMC 漏洞实例分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle009">CodeDom 漏洞模式与 SharePoint RCE</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle008">Datacon 2023 漏洞分析赛道赛题二官方题解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle007">IoT 设备中的认证绕过漏洞分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle006">Exchange Server(CVE-2023-36439)远程代码执行漏洞分析</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/tiangongarticle005">WAF防护绕过技巧分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle004">伪随机数问题浅析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle003">Windows内核竞态条件漏洞研究</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle002">Microsoft Hyper-V 虚拟 TPM 设备漏洞分析</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiangongarticle001">CVE-2023-0179 Linux内核提权</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="一、WAF介绍与分类"><header><h1 class="title_f1Hy" itemprop="headline">WAF防护绕过技巧分析</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-11-08T00:00:00.000Z" itemprop="datePublished">2023年11月8日</time> · <!-- -->阅读需 14 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo" src="https://tiangonglab.github.io/img/authors/ink.jpg" alt="ink" itemprop="image"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">ink</span></div><small class="avatar__subtitle" itemprop="description">专注于代码审计、漏洞挖掘及免杀对抗领域
</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一waf介绍与分类">一、WAF介绍与分类<a href="#一waf介绍与分类" class="hash-link" aria-label="一、WAF介绍与分类的直接链接" title="一、WAF介绍与分类的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一waf简介">（一）WAF简介<a href="#一waf简介" class="hash-link" aria-label="（一）WAF简介的直接链接" title="（一）WAF简介的直接链接">​</a></h3>
<p>Web应用防护系统（Web Application Firewall，网站应用级入侵防御系统），是通过执行一系列针对HTTP/HTTPS的安全策略来专门为Web应用提供保护的产品。</p>
<p>市场上的WAF产品有很多，像腾讯云，阿里云，长亭等，目前世界上常年排名第一的是以色列的 Imperva。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二waf分类">（二）WAF分类<a href="#二waf分类" class="hash-link" aria-label="（二）WAF分类的直接链接" title="（二）WAF分类的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="规则实现">规则实现<a href="#规则实现" class="hash-link" aria-label="规则实现的直接链接" title="规则实现的直接链接">​</a></h4>
<p>语义分析引擎WAF，国内大多数都是正则引擎，此外还有机器学习引擎。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署方式">部署方式<a href="#部署方式" class="hash-link" aria-label="部署方式的直接链接" title="部署方式的直接链接">​</a></h4>
<p>网络层WAF、应用层WAF、云WAF</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="waf部署方式">WAF部署方式<a href="#waf部署方式" class="hash-link" aria-label="WAF部署方式的直接链接" title="WAF部署方式的直接链接">​</a></h4>
<p><img loading="lazy" src="/assets/images/afec3247-2aa3-424f-8b89-eff0e861a82f-0f49f57fe4d7a2ad9dd40a8edfb8d4f7.png" width="1187" height="576" class="img_ev3q"></p>
<p>WAF大多是串联在这个链路中，起到一个阻断作用。就比如在Web Server和CGI之间的WAF，CGI这里特指PHP和ASP，像JSP一般就统一tomcat中间件了，就不需要CGI层了。</p>
<p>云部署一般先会起一个高防IP，然后用这个IP去连接WAF集群，一般来说都是从四层的流量解除七层的流量，然后再将正常的流量向后端转发，像这些企业A企业B可能在云上也可能不在。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二网络层waf-bypass">二、网络层WAF Bypass<a href="#二网络层waf-bypass" class="hash-link" aria-label="二、网络层WAF Bypass的直接链接" title="二、网络层WAF Bypass的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一分包分组">（一）分包分组<a href="#一分包分组" class="hash-link" aria-label="（一）分包分组的直接链接" title="（一）分包分组的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通过调整mss控制分包">通过调整MSS控制分包<a href="#通过调整mss控制分包" class="hash-link" aria-label="通过调整MSS控制分包的直接链接" title="通过调整MSS控制分包的直接链接">​</a></h4>
<p>控制MSS去调整TCP分包的大小 </p>
<p>单个TCP会话可能含有多个HTTP会话：比如TCP先建立一个三次握手，建立之后发送多个HTTP请求，并没有断开，一般的设备都会去很好的解析处理，但是有一些古老的设备只会去解析第一个，现在已经很少了。</p>
<p>单个TCP包发送多组HTTP报文（Pipeline技巧以及HTTP请求走私）：就是在DATA部分写多个http请求，有的设备就会认为第一个正常，那么后面的就类似于body部分，就会出现解析错误。</p>
<p>HTTP请求走私和Pipeline的区别就是请求走私利用不同的Content-Length引发歧义，比如下面这个，第一个content-length是包括了下面两个，或者content-length写一个1或者2，到底Web Server会取哪一个，需要针对不同的去研究，所以取值的解析差异，就会认为他是一整个或者是三个，利用这种方式就可以去迷惑WAF。</p>
<p><img loading="lazy" src="/assets/images/923bdb52-c5db-47cf-805a-eaf649f480a8-2ec03c5091b46b7b031c3f11cc49b18d.png" width="458" height="296" class="img_ev3q"></p>
<p>在标准的HTTP走私里面，一般content-length和Transfer-Encoding只会采纳一个，大部分优先是 Transfer-Encoding: chunked，当然也有一些两个都支持，就会出现一些问题。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="chunked">chunked<a href="#chunked" class="hash-link" aria-label="chunked的直接链接" title="chunked的直接链接">​</a></h4>
<p>利用chunked切分，比如下面是个最简单的chunked，对关键字进行一个拆分。</p>
<p><img loading="lazy" src="/assets/images/e7afbb3e-3a1f-47b7-a975-0b03679fbca2-42e0493a27449f24840d7a49b9e2656c.png" width="844" height="526" class="img_ev3q"></p>
<p>这里的5,4,3是以16进制写的，最后以0来结尾，如果是10个字符的话就要写A。</p>
<p>这种是只针对于网络层，应用层就不会出现这种问题，因为应用层是在完成chunked组包之后，才去解析，所以对应用层无效。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="三应用层waf-bypass">三、应用层WAF Bypass<a href="#三应用层waf-bypass" class="hash-link" aria-label="三、应用层WAF Bypass的直接链接" title="三、应用层WAF Bypass的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一multipartform-data">（一）multipart/form-data<a href="#一multipartform-data" class="hash-link" aria-label="（一）multipart/form-data的直接链接" title="（一）multipart/form-data的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="理论知识">理论知识<a href="#理论知识" class="hash-link" aria-label="理论知识的直接链接" title="理论知识的直接链接">​</a></h4>
<p>HTTP协议POST请求，除了常规的application/x-www-form-urlencoded以外，还有multipart/form-data这种形式，主要是为了解决上传文件场景下文件内容较大且内置字符不可控的问题。multipart/form-data格式也是可以传递POST参数的。对于Nginx+PHP的架构，Nginx实际上是不负责</p>
<p>解析multipart/form-data的body部分的，而是交由PHP来解析，因此WAF所获取的内容就很有可能与后端的PHP发生不一致。</p>
<p>使用以下脚本来进行测试</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo </span><span class="token function" style="color:#d73a49">file_get_contents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;php://input&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">var_dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$_POST</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">var_dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$_FILES</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>正常POST请求如下：</p>
<p><img loading="lazy" src="/assets/images/0ff64f40-166c-4e4f-9661-d7103bda20bb-b7e2248fd56fb1b87ebdea412bdb72a7.png" width="1390" height="506" class="img_ev3q"></p>
<p>change body encoding，如下：</p>
<p><img loading="lazy" src="/assets/images/13abf27f-5ba5-40f2-80bd-6607cec89d87-6881265cb168b071669aa66a72a9b25a.png" width="1380" height="470" class="img_ev3q"></p>
<p>只有input不太一样，一个有f=1一个没有，参数并没有进入Files数组，而是进入了_POST数据。那么，何时是上传文件？何时是POST参数呢？这个关键点在于有没有一个完整的filename=。这9个字符是经过反复测试的，缺一个字符不可，替换一个字符也不可，在其中添加一个字符更不可。</p>
<p>加上filename=之后：</p>
<p><img loading="lazy" src="/assets/images/464b3aa6-5de7-466d-9d43-0bf0f992f085-4f883c8b41eeb1c03f80d1947ac39a92.png" width="1474" height="772" class="img_ev3q"></p>
<p>可以看到这次并没有传给POST数组，而是传给了FILES数组变成了一个文件。</p>
<p>Bypass WAF的核心思想在于，一些WAF产品处于降低误报考虑，对用户上传文件的内容不做匹配，直接放行，比如一些压缩包图片之类的，在二进制流下面任意字符是不可控的，所以里面出现一些危险函数是很正常的。事实上，这些内容在绝大多数场景也无法引起攻击。所以让POST过去的数据去过那些规则，让FILES的只要符合白名单即可。</p>
<p>但关键问题在于，WAF能否准确有效识别出哪些内容是传给POST数组的，哪些传给_FILES数组？如果不能，那我们是否就可以想办法让WAF以为我们是在上传文件，而实际上却是在POST一个参数，这个参数可以是命令注入、SQL注入、SSRF等任意的一种攻击，这样就实现了通用WAF Bypass。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基础案例">基础案例<a href="#基础案例" class="hash-link" aria-label="基础案例的直接链接" title="基础案例的直接链接">​</a></h4>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0x00截断filename">0x00截断filename<a href="#0x00截断filename" class="hash-link" aria-label="0x00截断filename的直接链接" title="0x00截断filename的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/91de88d7-b5a5-48c5-9895-8fe64f9b7773-cfbbaf263bd01169dc57e2f795f9903b.png" width="1416" height="520" class="img_ev3q">截断之后发现传给了POST数组</p>
<p>有的WAF在处理包之前会将00删掉，再去解析会产生差异，所以有的地方00是不能删的，所以会产生bypass</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="双写上传描述行">双写上传描述行<a href="#双写上传描述行" class="hash-link" aria-label="双写上传描述行的直接链接" title="双写上传描述行的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/347cc9aa-3a0f-42dc-8b86-6292e93f1625-447811112057136561c09f7be1b73ade.png" width="1430" height="532" class="img_ev3q">双写后，一些WAF会取第二行，而实际PHP会获取第一行</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="双写整个part开头部分">双写整个part开头部分<a href="#双写整个part开头部分" class="hash-link" aria-label="双写整个part开头部分的直接链接" title="双写整个part开头部分的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/7b67dc36-477b-4e81-86fd-02e8c9cf758c-e8915ee38e2ef9ad3b20e1b744bbfa05.png" width="1418" height="548" class="img_ev3q">可以看到取的还是第一行，只不过会将第二部分全部当成f的值，这里做SQL注入比较麻烦，需要将前面全都闭合掉，但是命令注入就很简单，直接将1给改成payload即可优先执行。</p>
<p>这里可以延伸出构造一个假的part</p>
<p><img loading="lazy" src="/assets/images/7a946a53-2a90-4765-bcc6-47db092d2f92-62ca30491687edab20b82b97f87b291f.png" width="1420" height="460" class="img_ev3q"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="构造假的part">构造假的part<a href="#构造假的part" class="hash-link" aria-label="构造假的part的直接链接" title="构造假的part的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/dfd5f278-a367-45e0-b4f0-73ffbc6f6cdc-19759d63b1832e8ece511406f45c2bd5.png" width="1404" height="456" class="img_ev3q">和上一个类似，少了一个换行，这样原本干扰的部分就不会取了</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="双写boundary">双写boundary<a href="#双写boundary" class="hash-link" aria-label="双写boundary的直接链接" title="双写boundary的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/9bbf5693-9c08-44e9-8b62-cf728ab8625a-b361a54b922bd3c040f107be41cbbf77.png" width="1408" height="575" class="img_ev3q"></p>
<p>可以看到是以a为主</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="双写content-type">双写Content-Type<a href="#双写content-type" class="hash-link" aria-label="双写Content-Type的直接链接" title="双写Content-Type的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/03ac2393-b053-4fcf-9ebd-26d3202a10bc-28aae62d58034d25f715665a17ac9a41.png" width="1396" height="578" class="img_ev3q"></p>
<p>还是以a为主</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="空boundary">空boundary<a href="#空boundary" class="hash-link" aria-label="空boundary的直接链接" title="空boundary的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/28361d93-cd48-4e8e-9bc2-db0a5ddac9ba-dddea1d6ce12c1b0cdffaca8e767aaae.png" width="1398" height="566" class="img_ev3q"></p>
<p>有些WAF可能会认为boundary是；但是实际上boundary是空的</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="空格boundary">空格boundary<a href="#空格boundary" class="hash-link" aria-label="空格boundary的直接链接" title="空格boundary的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/81633a33-e191-48ab-bd76-dbcd4d4029b9-076bc31df477df34a43e756e601e9954.png" width="1408" height="548" class="img_ev3q"></p>
<p>有些WAF会把空格给去掉</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boundary中的逗号">boundary中的逗号<a href="#boundary中的逗号" class="hash-link" aria-label="boundary中的逗号的直接链接" title="boundary中的逗号的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/69566fca-f2b8-4f8c-b02e-aa397f5c1d31-1752aa4331e8c7f9a2452f20690fb124.png" width="1404" height="560" class="img_ev3q">boundary遇到逗号就结束了，所以取到的是a</p>
<p>同理，如果是 <strong>==,; ==</strong>，如下：</p>
<p><img loading="lazy" src="/assets/images/c426ea3e-afab-43a2-a111-98fc8a1bd03c-2bf25d8f0bd10e2b7ddfc4d745270b4a.png" width="1400" height="558" class="img_ev3q"></p>
<p>此时boundary还是空</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="进阶案例">进阶案例<a href="#进阶案例" class="hash-link" aria-label="进阶案例的直接链接" title="进阶案例的直接链接">​</a></h4>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0x00进阶">0x00进阶<a href="#0x00进阶" class="hash-link" aria-label="0x00进阶的直接链接" title="0x00进阶的直接链接">​</a></h5>
<p><img loading="lazy" src="/assets/images/213c19e5-9305-4358-9b98-118904401e74-8c158fed8bf92ea5fdbc43ce4818666c.png" width="1408" height="766" class="img_ev3q"></p>
<p>如果是这样双写，其实是以第一行为主的，这样就是上传文件。但如果我们在适当的地方加入0x00、空格和 \t ， 就会破坏第一行，让PHP反以第二行为主：</p>
<p><img loading="lazy" src="/assets/images/ce29712c-f8d9-4016-8df7-a217c210d2ac-251453f1365d99308f5102090107efdb.png" width="1396" height="452" class="img_ev3q"></p>
<p>如上图，随便在这三个地方加上空格  ，都会以第二行为主，这样防御是比较困难的，将其替换为0x00和0x20与之同理， 可自行测试</p>
<p>此外，在filename前面，和参数名f后面，加上0x00也是可以绕过的</p>
<p><img loading="lazy" src="/assets/images/795dc3e3-2abf-47a4-92fb-9c2e537617e2-14a3f0315a5ccbcbad1896f8e5122a7e.png" width="1404" height="442" class="img_ev3q"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="boundary进阶">boundary进阶<a href="#boundary进阶" class="hash-link" aria-label="boundary进阶的直接链接" title="boundary进阶的直接链接">​</a></h5>
<p>boundary的名称是可以前后加入任意内容的，WAF如果严格按boundary去取，就可以绕过</p>
<p><img loading="lazy" src="/assets/images/71481c18-21e4-47cb-b5eb-458722cd4a7e-cca1255205472792c978bfac99927dd8.png" width="1396" height="560" class="img_ev3q"></p>
<p>如何取boundary也是一个问题，如下：</p>
<p><img loading="lazy" src="/assets/images/76435c2b-f86f-4547-a34b-a73460c64499-fcfdf0767d298ee35d2d76d09b59d2e3.png" width="1400" height="526" class="img_ev3q"></p>
<p>这里取boundary=b为boundary</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="单双引号混合进阶">单双引号混合进阶<a href="#单双引号混合进阶" class="hash-link" aria-label="单双引号混合进阶的直接链接" title="单双引号混合进阶的直接链接">​</a></h5>
<p>需要考虑的问题是，Content-Disposition中的字段使用单引号还是双引号</p>
<p><img loading="lazy" src="/assets/images/42991e56-19ae-4e5b-89bc-642e023077d3-9dca53023f3f38173b4a43eee7571b3a.png" width="1398" height="536" class="img_ev3q"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="urlencoded伪装成为multipart">urlencoded伪装成为multipart<a href="#urlencoded伪装成为multipart" class="hash-link" aria-label="urlencoded伪装成为multipart的直接链接" title="urlencoded伪装成为multipart的直接链接">​</a></h5>
<p>实际上是urlencoded，但是伪装成了multipart，通过&amp;来截取前后装饰部分，保留id参数的完整性。理论上multipart/form-data 下的内容不进行urldecoded，一些WAF也正是这样设计的，这样做本没有问题，但是如果是urlencoded格式的内容，不进行url解码就会引入%0a这样字符，而这样的字符不解码是可以直接绕过防护规则的，从而导致了绕过。</p>
<p><img loading="lazy" src="/assets/images/425f3c95-67ee-4e0c-80b6-e173042efd9d-170c006a4440e2868bb6d1ce5173eca9.png" width="1400" height="676" class="img_ev3q"></p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="skip_upload">skip_upload<a href="#skip_upload" class="hash-link" aria-label="skip_upload的直接链接" title="skip_upload的直接链接">​</a></h5>
<p>在php源码 rfc1867.c line 909</p>
<div class="language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* If file_uploads=off, skip the file part */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!PG(file_uploads)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                skip_upload = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (upload_cnt &lt;= 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                skip_upload = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sapi_module.sapi_error(E_WARNING, &quot;Maximum number of allowable file uploads has been exceeded&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maximum number of allowable file uploads has been exceeded ，如何达到Maximum？ 发现在php 5.2.12和以上的版本，有一个隐藏的文件上传限制是在php.ini里没有的，就是这个max_file_uploads的设定，该默认值是20, 在php 5.2.17的版本中该值已不再隐藏。文件上传限制最大默认设为20，所以一次上传最大就是20个文档，所以超出20个就会出错了。</p>
<p>如下：</p>
<p><img loading="lazy" src="/assets/images/29f41f21-6fbc-40ba-9efd-7b699fac9828-95d82360b2564ff4d805bb3d2dbd248b.png" width="1394" height="790" class="img_ev3q"></p>
<p>拼接了从a-t这20个part，实际上就填满了Maximum，导致最后一个upload无法生效，就只能从FILES转化为POST了</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二其他技巧">（二）其他技巧<a href="#二其他技巧" class="hash-link" aria-label="（二）其他技巧的直接链接" title="（二）其他技巧的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="host替换">Host替换<a href="#host替换" class="hash-link" aria-label="Host替换的直接链接" title="Host替换的直接链接">​</a></h4>
<p>host如果是一个域名，可以在最后面加一个点 ==.== ，大多数情况下表示的还是当前域名，比如之前阿里云，防护的话是用过域名控制的，传过来 一个域名会先看一下有没有受到保护，假如原来的域名受到了保护，但是加了一个点，就不在名单内了，就会被认为没有开WAF</p>
<p><img loading="lazy" src="/assets/images/6ec1b459-5ec9-4418-8800-6fe12111677e-30f0e6ed3e484507a5b9787a8c632b9b.png" width="1208" height="726" class="img_ev3q"></p>
<p>还可以把Host的IP转为16进制</p>
<p><img loading="lazy" src="/assets/images/0317a668-73cf-4061-aad9-f8b28a61480f-fb4126a60ade24eebec6c80e90ac6e27.png" width="1394" height="702" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="url与替换">URL#与../替换<a href="#url与替换" class="hash-link" aria-label="URL#与../替换的直接链接" title="URL#与../替换的直接链接">​</a></h4>
<p>如果有时候加上#引发歧义的话，可以使用../跳出</p>
<p>如果#不可以的话，可以尝试?#</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http参数污染">HTTP参数污染<a href="#http参数污染" class="hash-link" aria-label="HTTP参数污染的直接链接" title="HTTP参数污染的直接链接">​</a></h4>
<p>比如双参数</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">?id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>有些架构会将两个拼接在一起，单独任何一个都没有问题，拼在一起就有问题了，这种的话要看后端的业务逻辑</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http09">HTTP/0.9<a href="#http09" class="hash-link" aria-label="HTTP/0.9的直接链接" title="HTTP/0.9的直接链接">​</a></h4>
<p>在HTTP/0.9中是没有响应头的</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="利用chuncked构造content-length为0">利用chuncked构造content-length为0<a href="#利用chuncked构造content-length为0" class="hash-link" aria-label="利用chuncked构造content-length为0的直接链接" title="利用chuncked构造content-length为0的直接链接">​</a></h4>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token header header-name keyword" style="color:#00009f">Content-Length</span><span class="token header punctuation" style="color:#393A34">:</span><span class="token header header-value">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token header header-name keyword" style="color:#00009f">Transfer-Encoding</span><span class="token header punctuation" style="color:#393A34">:</span><span class="token header"> </span><span class="token header header-value">chuncked</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>两个同时出现一般会报错，如果像上面这样的话，body部分可以随便写，不会被过滤</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="加入中文字符">加入中文字符<a href="#加入中文字符" class="hash-link" aria-label="加入中文字符的直接链接" title="加入中文字符的直接链接">​</a></h4>
<p>针对于特殊框架，会被替换为空</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="http方法构造">HTTP方法构造<a href="#http方法构造" class="hash-link" aria-label="HTTP方法构造的直接链接" title="HTTP方法构造的直接链接">​</a></h4>
<p>使用一些存在的，常用HEAD</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加xff头">添加XFF头<a href="#添加xff头" class="hash-link" aria-label="添加XFF头的直接链接" title="添加XFF头的直接链接">​</a></h4>
<p>127.0.0.1或者localhost</p>
<p>理论可行，需要看网络架构</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="四总结">四、总结<a href="#四总结" class="hash-link" aria-label="四、总结的直接链接" title="四、总结的直接链接">​</a></h2>
<p>以上这些技巧是根据原理、实践所得，参考了网上部分文章总结所得，WAF绕过并没有固定的模式，在黑盒情况下甚至你可以将所有技巧同时运用以达到目的，总之，要在不断的尝试中去绕过，然后再通过“控制变量”法去探测到底是哪一种方法奏效，以达到“通杀”的目标。</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/waf">WAF</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/TianGongLab/poc_docs/tree/main/blog/2023-11-08-WAF-bypass-tech-analysis/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/tiangongarticle006"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">Exchange Server(CVE-2023-36439)远程代码执行漏洞分析</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tiangongarticle004"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">伪随机数问题浅析</div></a></nav><div style="margin-top:20px"></div></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一waf介绍与分类" class="table-of-contents__link toc-highlight">一、WAF介绍与分类</a><ul><li><a href="#一waf简介" class="table-of-contents__link toc-highlight">（一）WAF简介</a></li><li><a href="#二waf分类" class="table-of-contents__link toc-highlight">（二）WAF分类</a></li></ul></li><li><a href="#二网络层waf-bypass" class="table-of-contents__link toc-highlight">二、网络层WAF Bypass</a><ul><li><a href="#一分包分组" class="table-of-contents__link toc-highlight">（一）分包分组</a></li></ul></li><li><a href="#三应用层waf-bypass" class="table-of-contents__link toc-highlight">三、应用层WAF Bypass</a><ul><li><a href="#一multipartform-data" class="table-of-contents__link toc-highlight">（一）multipart/form-data</a></li><li><a href="#二其他技巧" class="table-of-contents__link toc-highlight">（二）其他技巧</a></li></ul></li><li><a href="#四总结" class="table-of-contents__link toc-highlight">四、总结</a></li></ul></div></div></div></div></div></div>
</body>
</html>
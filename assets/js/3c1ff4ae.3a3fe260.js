"use strict";(self.webpackChunkpoc_docs=self.webpackChunkpoc_docs||[]).push([[6300],{62492:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>t,contentTitle:()=>a,default:()=>o,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var c=n(74848),d=n(28453);const i={slug:"tiangongarticle021",title:"FortiGate SSLVPN CVE-2024-21762\u6f0f\u6d1e\u5229\u7528\u5206\u6790",authors:"lizibo",tags:["FortiGate","SSLVPN","CVE"]},a="FortiGate SSLVPN CVE-2024-21762\u6f0f\u6d1e\u5229\u7528\u5206\u6790",r={permalink:"/blog/tiangongarticle021",editUrl:"https://github.com/TianGongLab/poc_docs/tree/main/blog/2024-03-13-fortigate-sslvpn-cve-2024-21762/index.md",source:"@site/blog/2024-03-13-fortigate-sslvpn-cve-2024-21762/index.md",title:"FortiGate SSLVPN CVE-2024-21762\u6f0f\u6d1e\u5229\u7528\u5206\u6790",description:"\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb",date:"2024-03-13T00:00:00.000Z",formattedDate:"2024\u5e743\u670813\u65e5",tags:[{label:"FortiGate",permalink:"/blog/tags/forti-gate"},{label:"SSLVPN",permalink:"/blog/tags/sslvpn"},{label:"CVE",permalink:"/blog/tags/cve"}],readingTime:10.37,hasTruncateMarker:!0,authors:[{name:"zbleet",title:"\u4e8c\u8fdb\u5236\u5b89\u5168\u3001IoT\u5b89\u5168\u3001\u6d4f\u89c8\u5668\u5b89\u5168",imageURL:"https://tiangonglab.github.io/img/authors/zbleet.jpg",key:"lizibo"}],frontMatter:{slug:"tiangongarticle021",title:"FortiGate SSLVPN CVE-2024-21762\u6f0f\u6d1e\u5229\u7528\u5206\u6790",authors:"lizibo",tags:["FortiGate","SSLVPN","CVE"]},unlisted:!1,nextItem:{title:"Ghidra\u811a\u672c\u7f16\u5199\uff1a\u4eceIR\u5230\u53cd\u7f16\u8bd1C",permalink:"/blog/tiangongarticle020"}},t={authorsImageUrls:[void 0]},l=[{value:"\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb",id:"\u4e00\u6f0f\u6d1e\u7b80\u4ecb",level:2},{value:"\u4e8c\u3001\u6f0f\u6d1e\u5206\u6790",id:"\u4e8c\u6f0f\u6d1e\u5206\u6790",level:2},{value:"2.1 diff patch",id:"21-diff-patch",level:3},{value:"2.2 \u89e6\u53d1\u8d8a\u754c\u5199",id:"22-\u89e6\u53d1\u8d8a\u754c\u5199",level:3},{value:"\u4e09\u3001\u6f0f\u6d1e\u5229\u7528",id:"\u4e09\u6f0f\u6d1e\u5229\u7528",level:2},{value:"3.1 \u5931\u8d25\u7684\u5c1d\u8bd5",id:"31-\u5931\u8d25\u7684\u5c1d\u8bd5",level:3},{value:"3.2 \u5bfb\u627e\u6808\u4e0a\u7684\u5185\u5b58\u6307\u9488",id:"32-\u5bfb\u627e\u6808\u4e0a\u7684\u5185\u5b58\u6307\u9488",level:3},{value:"3.3 \u52ab\u6301\u7ed3\u6784\u4f53",id:"33-\u52ab\u6301\u7ed3\u6784\u4f53",level:3},{value:"3.4 \u5bfb\u627e\u53ef\u5229\u7528\u7684\u591a\u7ea7\u6307\u9488",id:"34-\u5bfb\u627e\u53ef\u5229\u7528\u7684\u591a\u7ea7\u6307\u9488",level:3},{value:"3.5 \u52ab\u6301RIP",id:"35-\u52ab\u6301rip",level:3},{value:"3.6 ROP",id:"36-rop",level:3},{value:"\u56db\u3001\u5229\u7528\u6f14\u793a",id:"\u56db\u5229\u7528\u6f14\u793a",level:2},{value:"\u4e94\u3001\u603b\u7ed3",id:"\u4e94\u603b\u7ed3",level:2}];function h(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.h2,{id:"\u4e00\u6f0f\u6d1e\u7b80\u4ecb",children:"\u4e00\u3001\u6f0f\u6d1e\u7b80\u4ecb"}),"\n",(0,c.jsxs)(s.p,{children:["FortiGate\u4e8c\u6708\u4efd\u53d1\u5e03\u7248\u672c\u66f4\u65b0\uff0c\u4fee\u590d\u591a\u4e2a\u4e2d\u9ad8\u5371\u6f0f\u6d1e\uff0c\u5176\u4e2d\u4e00\u4e2a\u4e25\u91cd\u7ea7\u522b\u6f0f\u6d1e\u662fSSL VPN\u7684\u672a\u6388\u6743\u8d8a\u754c\u5199\u6f0f\u6d1e\uff0c",(0,c.jsx)(s.a,{href:"https://www.fortiguard.com/psirt/FG-IR-24-015",children:"\u6f0f\u6d1e\u9884\u8b66"}),"\u79f0\u8be5\u6f0f\u6d1e\u53ef\u80fd\u88ab\u5728\u91ce\u5229\u7528\u3002\u672c\u6587\u5c06\u4ecb\u7ecd\u7b14\u8005\u5206\u6790\u5229\u7528\u8be5\u6f0f\u6d1e\uff0c\u5b9e\u73b0\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u7684\u8fc7\u7a0b\u3002"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{alt:"https://www.fortiguard.com/psirt/FG-IR-24-015",src:n(52429).A+"",width:"1830",height:"388"})}),"\n",(0,c.jsx)(s.h2,{id:"\u4e8c\u6f0f\u6d1e\u5206\u6790",children:"\u4e8c\u3001\u6f0f\u6d1e\u5206\u6790"}),"\n",(0,c.jsxs)(s.p,{children:["\u672c\u6587\u6f0f\u6d1e\u5206\u6790\u4f7f\u7528\u7684\u73af\u5883\u662f",(0,c.jsx)(s.code,{children:"FGT_VM64-v7.4.2.F-build2571"}),"\u3002"]}),"\n",(0,c.jsx)(s.h3,{id:"21-diff-patch",children:"2.1 diff patch"}),"\n",(0,c.jsxs)(s.p,{children:["\u5bf9\u4fee\u590d\u7248\u672c\u7684\u4e8c\u8fdb\u5236\u8fdb\u884c\u5bf9\u6bd4\uff087.4.2\u548c7.4.3\uff09\uff0c\u5206\u6790\u53d1\u73b0\u4fee\u590d\u4ee3\u7801\u4f4d\u4e8e\u51fd\u6570",(0,c.jsx)(s.code,{children:"sub_18F4980"}),"(7.4.2)\u3002"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(56796).A+"",width:"1973",height:"1445"})}),"\n",(0,c.jsxs)(s.p,{children:["\u5206\u6790\u8be5\u51fd\u6570\u4e0d\u96be\u53d1\u73b0\uff0c\u8be5\u51fd\u6570\u903b\u8f91\u662f\u8bfb\u53d6HTTP POST\u8bf7\u6c42\u7684body\u6570\u636e\u3002\u540c\u65f6\u6839\u636e",(0,c.jsx)(s.code,{children:"Transfer-Encoding"}),"\u8bf7\u6c42\u5934\u5224\u65ad\u662f\u6309\u7167chunk\u683c\u5f0f\u8bfb\u53d6\uff0c\u8fd8\u662f\u6839\u636e",(0,c.jsx)(s.code,{children:"Content-Length"}),"\u8bfb\u53d6\u3002\u6839\u636e\u63a7\u5236\u6d41\u56fe\u5bf9\u6bd4\u7ed3\u679c\uff0c\u5b58\u5728\u4e24\u5904\u4ee3\u7801\u4fee\u6539\uff1a"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsxs)(s.li,{children:["\u89e3\u6790chunk\u683c\u5f0f\u65f6\uff0c\u8c03\u7528",(0,c.jsx)(s.code,{children:"ap_getline"}),"\u8bfb\u53d6\u5206\u5757\u957f\u5ea6\uff0c\u68c0\u67e5",(0,c.jsx)(s.code,{children:"ap_getline"}),"\u7684\u8fd4\u56de\u503c\u662f\u5426\u5927\u4e8e16\uff0c\u5927\u4e8e16\u8ba4\u4e3a\u662f\u975e\u6cd5\u7684chunk length\u3002\n",(0,c.jsx)(s.img,{src:n(59133).A+"",width:"2277",height:"1221"})]}),"\n",(0,c.jsxs)(s.li,{children:["\u8bfb\u53d6chunk trailer\u65f6\uff0c\u5199\u5165",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\u7684\u504f\u79fb",(0,c.jsx)(s.code,{children:"line_off"}),"\u7684\u8d4b\u503c\u6765\u6e90\uff0c\u4fee\u590d\u524d",(0,c.jsx)(s.code,{children:"line_off"}),"\u7684\u503c\u6765\u6e90\u4e8e",(0,c.jsx)(s.code,{children:"*(_QWORD *)(a1 + 744)"}),"\uff0c\u4fee\u590d\u540e",(0,c.jsx)(s.code,{children:"line_off"}),"\u4e3a",(0,c.jsx)(s.code,{children:"ap_getline"}),"\u7684\u8fd4\u56de\u503c\u3002\n",(0,c.jsx)(s.img,{src:n(57022).A+"",width:"2247",height:"1249"})]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["\u7ee7\u7eed\u5411\u524d\u56de\u6eaf\uff0c\u53ef\u4ee5\u627e\u5230",(0,c.jsx)(s.code,{children:"*(_QWORD *)(a1 + 744)"}),"\u7684\u503c\u6b63\u662f\u7b2c\u4e00\u5904\u6821\u9a8c\u7684chunk length\u5b57\u6bb5\u7684\u957f\u5ea6"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(31642).A+"",width:"945",height:"395"})}),"\n",(0,c.jsx)(s.p,{children:"\u540c\u65f6\u9605\u8bfb\u4ee3\u7801\u53ef\u4ee5\u5f97\u77e5\uff0c\u5f53chunk length\u5b57\u6bb5\u7ecf\u8fc7hex\u89e3\u7801\u540e\u503c\u4e3a0\u65f6\uff0c\u5c31\u4f1a\u8fdb\u5165\u5230chunk trailer\u8bfb\u53d6\u7684\u903b\u8f91\u3002"}),"\n",(0,c.jsx)(s.h3,{id:"22-\u89e6\u53d1\u8d8a\u754c\u5199",children:"2.2 \u89e6\u53d1\u8d8a\u754c\u5199"}),"\n",(0,c.jsx)(s.p,{children:"\u7ecf\u8fc7\u5bf9patch\u7684\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u7ed3\u8bba\uff1a"}),"\n",(0,c.jsx)(s.p,{children:"1\u3001\u89e3\u6790chunk\u65f6\uff0c\u5982\u679cchunk length\u5b57\u6bb5hex\u89e3\u7801\u540e\u503c\u4e3a0\uff0c\u5219\u5f00\u59cbchunk trailer\u7684\u8bfb\u53d6\u3002"}),"\n",(0,c.jsxs)(s.p,{children:["2\u3001\u8c03\u7528ap_getline\u8bfb\u53d6chunk trailer\u540e\uff0c\u4f1a\u6839\u636echunk length\u5b57\u6bb5\u7684\u957f\u5ea6\u5411\u7f13\u51b2\u533a\u4e2d\u5199\u5165",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\u3002"]}),"\n",(0,c.jsxs)(s.p,{children:["\u56e0\u6b64\uff0c\u5982\u679cchunk length\u5b57\u6bb5\u4f20\u5165\u5f88\u591a\u4e2a0\uff0c0\u7684\u957f\u5ea6\u5927\u4e8e\u5269\u4f59\u7f13\u51b2\u533a\u957f\u5ea6\u76841/2\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u8d8a\u754c\u5199\u5165",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\u3002\u901a\u8fc7\u8c03\u8bd5\u53ef\u77e5\u76ee\u6807\u7f13\u51b2\u533a\u4f4d\u4e8e\u6808\u4e0a\uff08\u51fd\u6570sub_1A111E0\uff09\uff0c\u504f\u79fb0x2028\u7684\u4f4d\u7f6e\u4fdd\u5b58\u4e86\u8fd4\u56de\u5730\u5740\u3002\u5982\u679c\u5728\u504f\u79fb0x202e\u7684\u4f4d\u7f6e\u5199\u5165",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\uff0c\u5f53\u51fd\u6570\u8fd4\u56de\u6267\u884c",(0,c.jsx)(s.code,{children:"ret"}),"\u6307\u4ee4\u6062\u590drip\u65f6\u5c31\u4f1a\u56e0\u5730\u5740\u975e\u6cd5\u4ea7\u751f\u5d29\u6e83\u3002"]}),"\n",(0,c.jsx)(s.p,{children:"Crash PoC\uff1a"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-python",children:'pkt = b"""\\\nGET / HTTP/1.1\nHost: %s\nTransfer-Encoding: chunked\n\n%s\\r\\n%s\\r\\n\\r\\n""" % (hostname.encode(), b"0"*((0x202e//2)-2), b"a")\n\nssock = create_ssock(hostname, port)\nssock.send(pkt)\nssock.recv(4096)\n'})}),"\n",(0,c.jsx)(s.p,{children:"\u5d29\u6e83\u73b0\u573a\uff1a"}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(46386).A+"",width:"839",height:"271"})}),"\n",(0,c.jsx)(s.h2,{id:"\u4e09\u6f0f\u6d1e\u5229\u7528",children:"\u4e09\u3001\u6f0f\u6d1e\u5229\u7528"}),"\n",(0,c.jsxs)(s.p,{children:["\u901a\u8fc7\u5206\u6790\u6f0f\u6d1e\u6210\u56e0\u53ef\u77e5\uff0c\u5229\u7528\u8be5\u6f0f\u6d1e\u53ef\u4ee5\u5b9e\u73b0\u6808\u4e0a\u8d8a\u754c\u5199",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\u4e24\u4e2a\u5b57\u8282\uff0c\u8d8a\u754c\u8303\u56f4\u63a5\u8fd10x2000\u3002\u7531\u4e8e\u5199\u5165\u7684\u5185\u5bb9\u975e\u5e38\u6709\u9650\uff0c\u65e0\u6cd5\u901a\u8fc7\u76f4\u63a5\u52ab\u6301rip\u5b9e\u73b0RCE\u3002\u56e0\u6b64\u9700\u8981\u628a\u76ee\u5149\u653e\u5728\u6808\u4e0a\u4fdd\u5b58\u7684\u5185\u5b58\u6307\u9488\u4e0a\u3002"]}),"\n",(0,c.jsx)(s.h3,{id:"31-\u5931\u8d25\u7684\u5c1d\u8bd5",children:"3.1 \u5931\u8d25\u7684\u5c1d\u8bd5"}),"\n",(0,c.jsxs)(s.p,{children:["\u6bd4\u8f83\u5bb9\u6613\u60f3\u5230\u7684\u662f\u52ab\u6301rbp\uff0c\u901a\u8fc7\u8986\u76d6rbp\u7684\u4f4e\u5b57\u8282\uff0c\u4f7frbp\u521a\u597d\u6307\u5411\u53ef\u63a7\u7684\u5185\u5b58\u533a\u57df\u3002\u5f53\u4e0a\u4e00\u7ea7\u51fd\u6570\u8fd4\u56de\u6267\u884c",(0,c.jsx)(s.code,{children:"leave ret"}),"\u6307\u4ee4\u65f6\uff0c\u5c31\u53ef\u4ee5\u5b8c\u5168\u52ab\u6301rip\u3002\u7136\u800c\u9a8c\u8bc1\u65f6\u53d1\u73b0\u5373\u4f7f\u8986\u76d6\u4e86\u6808\u4e0a\u7684rbp\uff0c\u4e5f\u65e0\u6cd5\u52ab\u6301rsp\u548crip\uff0c\u751a\u81f3\u7a0b\u5e8f\u4e0d\u4f1a\u4ea7\u751f\u5d29\u6e83\u3002\u7ee7\u7eed\u5411\u4e0a\u56de\u6eaf\uff0c\u627e\u5230",(0,c.jsx)(s.code,{children:"sub_1A111E0"}),"\u7684\u7236\u51fd\u6570",(0,c.jsx)(s.code,{children:"sub_1A26040"}),"\uff0c\u8be5\u51fd\u6570\u5728\u8fd4\u56de\u65f6\u5e76\u6ca1\u6709\u8c03\u7528",(0,c.jsx)(s.code,{children:"leave ret"}),"\u6765\u6062\u590drsp\uff0c\u800c\u662f\u76f4\u63a5",(0,c.jsx)(s.code,{children:"add rsp, 0x18"}),"\uff0c\u56e0\u6b64\u65e0\u6cd5\u8fbe\u5230\u9884\u671f\u7684\u6548\u679c\u3002"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(24116).A+"",width:"957",height:"261"})}),"\n",(0,c.jsx)(s.h3,{id:"32-\u5bfb\u627e\u6808\u4e0a\u7684\u5185\u5b58\u6307\u9488",children:"3.2 \u5bfb\u627e\u6808\u4e0a\u7684\u5185\u5b58\u6307\u9488"}),"\n",(0,c.jsxs)(s.p,{children:["\u5982\u4e0a\u4e00\u5c0f\u8282\u770b\u5230\u7684\u90a3\u6837\uff0c",(0,c.jsx)(s.code,{children:"sub_1A26040"}),"\u51fd\u6570\u5728\u6808\u4e0a\u4fdd\u5b58\u4e86rbx\u3001r12-r15\u4e94\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5e76\u5728\u51fd\u6570\u8fd4\u56de\u65f6\u6062\u590d\u8fd9\u4e9b\u5bc4\u5b58\u5668\u3002\u7ee7\u7eed\u5411\u4e0a\u56de\u6eaf\u627e\u5230\u7236\u51fd\u6570",(0,c.jsx)(s.code,{children:"sub_1A27650"}),"\u3002\u53ef\u4ee5\u770b\u5230r13\u4e2d\u4fdd\u5b58\u7684\u6b63\u662f\u53c2\u6570",(0,c.jsx)(s.code,{children:"a1"}),"\u3002"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(79945).A+"",width:"909",height:"71"})}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"a1"}),"\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\u6307\u9488\uff0c\u901a\u8fc7\u8c03\u8bd5\u4e5f\u53ef\u4ee5\u770b\u51fa\u6808\u4e0a\u4fdd\u5b58\u7684",(0,c.jsx)(s.code,{children:"r13"}),"\u662f\u4e00\u4e2a\u5806\u5730\u5740"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(89871).A+"",width:"857",height:"167"})}),"\n",(0,c.jsxs)(s.p,{children:["\u5982\u679c\u901a\u8fc7\u8d8a\u754c\u5199\u8986\u76d6\u56fe\u4e2d\u7ea2\u8272\u533a\u57df\u7684\u5185\u5b58\uff0c\u90a3\u4e48",(0,c.jsx)(s.code,{children:"sub_1A26040"}),"\u51fd\u6570\u8fd4\u56de\u65f6\u6062\u590dr13\u5bc4\u5b58\u5668\uff0c\u5c31\u53ef\u4ee5\u7be1\u6539",(0,c.jsx)(s.code,{children:"a1"}),"\u6307\u9488\u7684\u503c\u3002\u5982\u679c\u80fd\u591f\u5bf9\u5806\u5185\u5b58\u8fdb\u884c\u5e03\u5c40\uff0c\u4f7f\u5f97a1\u6307\u5411\u63d0\u524d\u5e03\u7f6e\u597d\u7684\u5185\u5b58\u533a\u57df\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u52ab\u6301\u6574\u4e2aa1\u7ed3\u6784\u4f53\u3002\u540c\u65f6\u901a\u8fc7\u5206\u6790",(0,c.jsx)(s.code,{children:"sub_1A27650"}),"\u548c",(0,c.jsx)(s.code,{children:"sub_1A26040"}),"\u7684\u4ee3\u7801\u903b\u8f91\uff0c\u5176\u4e2d\u5b58\u5728\u5927\u91cfa1\u591a\u7ea7\u7ed3\u6784\u4f53\u6210\u5458\u7684\u52a8\u6001\u51fd\u6570\u8c03\u7528\uff0c\u56e0\u6b64\u52ab\u6301a1\u4f1a\u6709\u66f4\u591a\u7684\u5229\u7528\u673a\u4f1a\u3002"]}),"\n",(0,c.jsx)(s.h3,{id:"33-\u52ab\u6301\u7ed3\u6784\u4f53",children:"3.3 \u52ab\u6301\u7ed3\u6784\u4f53"}),"\n",(0,c.jsxs)(s.p,{children:["\u6839\u636e\u8bbe\u60f3\uff0ca1\u6307\u9488\u7684\u4f4e\u5b57\u8282\u88ab\u8986\u76d6\u6210",(0,c.jsx)(s.code,{children:"\\r\\n"}),"\u540e\uff0c\u53ef\u4ee5\u6070\u597d\u6307\u5411\u9884\u5148\u5e03\u7f6e\u597d\u7684\u5185\u5b58\u3002\u5982\u56fe\u6240\u793a\uff1a"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(29980).A+"",width:"1327",height:"819"})}),"\n",(0,c.jsx)(s.p,{children:"\u4e3a\u5b9e\u73b0\u8fd9\u4e00\u6548\u679c\uff0c\u9700\u8981\u8fbe\u6210\u5982\u4e0b\u6761\u4ef6\uff1a"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsx)(s.li,{children:"a1\u7ed3\u6784\u4f53\u5730\u5740\u6bd4\u5806\u55b7\u533a\u57df\u5730\u5740\u66f4\u9ad8\uff0c\u5e76\u4e14\u4e8c\u8005\u95f4\u9694\u5f88\u5c0f\u3002"}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.code,{children:"0x7fxxxxxxx0a0d"}),"\u4e00\u5b9a\u6307\u5411\u4f2a\u9020\u7684\u7ed3\u6784\u4f53\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["\u8c03\u8bd5\u53ef\u4ee5\u53d1\u73b0a1\u7ed3\u6784\u4f53\u7684\u5927\u5c0f\u662f0x730\uff0c\u6839\u636ejemalloc\u7684\u5bf9\u9f50\u89c4\u5219\uff0c\u4f1a\u5206\u914d\u52300x800\u5927\u5c0f\u7684\u5806\u5757\u30020x800\u7684\u5806\u5757\u5728\u8bf7\u6c42\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\u5e76\u4e0d\u5e38\u7528\uff0c\u56e0\u6b64\u5f88\u5bb9\u6613\u628atcache\u4e2d0x800\u7684\u5806\u5757\u8017\u5c3d\uff0c\u540c\u65f6\u7533\u8bf7\u66f4\u591a\u65b0\u76840x800\u7684\u5757\uff0c\u4f7f\u5f97\u91ca\u653e\u540e\u8fdb\u5165tcache\u3002\u5806\u55b7\u4e5f\u9009\u62e9\u4e0d\u5e38\u7528\u7684\u5927\u5c0f\u7684\u5806\u5757\uff0c\u4f7f\u5f97\u65b0\u7533\u8bf7\u7684\u5806\u5757\u662f\u8fde\u7eed\u7684\uff0c\u540c\u65f6\u4e0e\u65b0\u7533\u8bf7\u76840x800\u8ddd\u79bb\u8f83\u8fd1\uff1b\u5806\u55b7\u9009\u62e9\u4f7f\u7528\u8f83\u5927\u5806\u5757\uff0c\u4ee5\u4fdd\u8bc1\u5176\u5730\u5740\u4e3a0x800\u5bf9\u9f50\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u505a\u5230\u6bcf\u4e00\u4e2a\u4f2a\u9020\u7684\u7ed3\u6784\u4f53\u5730\u5740\u7684\u4f4e12\u6bd4\u7279\u4e3a0xa0d\uff1b\u5806\u55b7\u8303\u56f4\u4e0d\u5c0f\u4e8e0x10000\uff0c\u4ee5\u4fdd\u8bc1",(0,c.jsx)(s.code,{children:"0x7fxxxxxxx0a0d"}),"\u6307\u5411\u5806\u55b7\u7684\u533a\u57df\u3002\u52ab\u6301\u540e\u7684\u6548\u679c\u5982\u56fe\uff1a"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(54620).A+"",width:"957",height:"663"})}),"\n",(0,c.jsx)(s.h3,{id:"34-\u5bfb\u627e\u53ef\u5229\u7528\u7684\u591a\u7ea7\u6307\u9488",children:"3.4 \u5bfb\u627e\u53ef\u5229\u7528\u7684\u591a\u7ea7\u6307\u9488"}),"\n",(0,c.jsxs)(s.p,{children:["\u901a\u8fc7\u4e0a\u8ff0\u64cd\u4f5c\uff0c\u53ef\u5b9e\u73b0a1\u7ed3\u6784\u4f53\u7684\u52ab\u6301\u3002\u68b3\u7406\u51fd\u6570",(0,c.jsx)(s.code,{children:"sub_1A27650"}),"\u548c",(0,c.jsx)(s.code,{children:"sub_1A26040"}),"\u7684\u4ee3\u7801\uff0c\u5176\u4e2d\u5b58\u5728\u591a\u5904a1\u7ed3\u6784\u4f53\u6210\u5458\u4e8c\u7ea7\u6307\u9488\u548c\u4e09\u7ea7\u6307\u9488\u7684\u52a8\u6001\u8c03\u7528\uff0c\u4f8b\u5982\uff1a"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(77991).A+"",width:"1137",height:"591"})}),"\n",(0,c.jsxs)(s.p,{children:["\u5f53\u6ee1\u8db3",(0,c.jsx)(s.code,{children:"*(_BYTE *)(a1+0x20*(N+6)+0x10)&6==0"}),"(0 < N < 5)\u65f6\uff0c\u5c31\u4f1a\u52a8\u6001\u8c03\u7528",(0,c.jsx)(s.code,{children:"*(__int64 (__fastcall **)(__int64))(*(_QWORD *)(*(_QWORD *)(a1 + 0x298)+0x70)+0xC0)(a1)"}),"\u56e0\u6b64\uff0c\u9700\u8981\u628a",(0,c.jsx)(s.code,{children:"a1 + 0x298"}),"\u6210\u5458\u4f2a\u9020\u6210\u4e00\u4e2a\u591a\u7ea7\u6307\u9488\uff0c\u6700\u7ec8\u6307\u5411\u6211\u4eec\u60f3\u8981\u8c03\u7528\u7684\u51fd\u6570\u3002\u7531\u4e8e\u76ee\u6807\u4e8c\u8fdb\u5236\u6ca1\u6709\u5f00\u542fPIE\u4fdd\u62a4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728\u76ee\u6807\u4e8c\u8fdb\u5236\u5bfb\u627e\u7b26\u5408\u6761\u4ef6\u7684\u591a\u7ea7\u6307\u9488\u3002\u5206\u6790\u4e8c\u8fdb\u5236\uff0c\u53ef\u4ee5\u53d1\u73b0Rela\u91cd\u5b9a\u4f4d\u8282\u4e2d\u6bcf\u4e00\u4e2a\u6761\u76ee\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\u90fd\u6307\u5411\u5bf9\u5e94\u51fd\u6570\u7684GOT\u8868\u5730\u5740\u3002"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{alt:"Rela\u91cd\u5b9a\u4f4d\u6761\u76ee",src:n(48289).A+"",width:"1879",height:"205"})}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{alt:"GOT\u8868",src:n(41841).A+"",width:"1591",height:"203"})}),"\n",(0,c.jsxs)(s.p,{children:["\u56e0\u6b64\uff0c\u4ee5",(0,c.jsx)(s.code,{children:"system"}),"\u51fd\u6570\u4e3a\u4f8b\u53ef\u4ee5\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u591a\u7ea7\u6307\u9488"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(6537).A+"",width:"749",height:"95"})}),"\n",(0,c.jsxs)(s.p,{children:["\u5728\u5806\u55b7\u65f6\uff0c\u5c06\u7ed3\u6784\u4f53\u504f\u79fb0x298\u5904\u7684\u503c\u6539\u6210",(0,c.jsx)(s.code,{children:"0x4368d0"}),"\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5bf9system\u51fd\u6570\u7684\u8c03\u7528\uff0c\u6548\u679c\u5982\u4e0b\uff1a"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(85382).A+"",width:"1249",height:"593"})}),"\n",(0,c.jsxs)(s.p,{children:["\u5982\u56fe\u6240\u793a\uff0c\u52a8\u6001\u8c03\u7528\u7684\u53c2\u6570\u6b63\u662fa1\uff0c\u6307\u5411\u7684\u5185\u5b58\u53ef\u63a7\u3002\u5230\u8fd9\u91cc\u6b63\u5e38\u5c31\u53ef\u4ee5\u5229\u7528system\u51fd\u6570\u6267\u884c\u4efb\u610f\u547d\u4ee4\u4e86\u3002\u4f46\u662f\u5728FortiGate\u4e2d\uff0c",(0,c.jsx)(s.code,{children:"/bin/sh"}),"\u6587\u4ef6\u4e0d\u5177\u5907\u6267\u884c\u547d\u4ee4\u7684\u80fd\u529b\uff0c\u56e0\u6b64\u4f7f\u7528system\u51fd\u6570\u6267\u884c\u547d\u4ee4\u65e0\u6cd5\u6267\u884c\u6210\u529f\u3002"]}),"\n",(0,c.jsx)(s.h3,{id:"35-\u52ab\u6301rip",children:"3.5 \u52ab\u6301RIP"}),"\n",(0,c.jsxs)(s.p,{children:["\u7531\u4e8esystem\u51fd\u6570\u65e0\u6cd5\u6267\u884c\u547d\u4ee4\uff0c\u53ea\u80fd\u518d\u60f3\u522b\u7684\u529e\u6cd5\u5b8c\u6210RCE\u3002\u73b0\u6709\u7684\u6761\u4ef6\u662f\u53ef\u4ee5\u8c03\u7528\u4efb\u610f\u7684GOT\u8868\u51fd\u6570\uff0c\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5411\u7684\u5185\u5b58\u53ef\u63a7\uff0c\u6240\u4ee5\u5982\u679cGOT\u8868\u4e2d\u5b58\u5728\u67d0\u4e2a\u51fd\u6570\u4f1a\u56de\u8c03\u53c2\u6570\u4e2d\u7684\u67d0\u4e2a\u6210\u5458\uff0c\u5c31\u6709\u673a\u4f1a\u5b9e\u73b0RIP\u52ab\u6301\u3002\u5f88\u5bb9\u6613\u60f3\u5230\u5728\u4ee5\u524d\u7684FortiGate\u6f0f\u6d1e\u5229\u7528\u4e2d\u7ecf\u5e38\u4f7f\u7528\u5230\u7684\u51fd\u6570",(0,c.jsx)(s.code,{children:"SSL_do_handshake"}),"\u3002"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-c",children:"int SSL_do_handshake(SSL *s)\n{\n    // ...\n\n    s->method->ssl_renegotiate_check(s, 0);\n\n    if (SSL_in_init(s) || SSL_in_before(s)) {\n        if ((s->mode & SSL_MODE_ASYNC) && ASYNC_get_current_job() == NULL) {\n            struct ssl_async_args args;\n\n            args.s = s;\n\n            ret = ssl_start_async_job(s, &args, ssl_do_handshake_intern);\n        } else {\n            ret = s->handshake_func(s);\n        }\n    }\n    return ret;\n}\n"})}),"\n",(0,c.jsxs)(s.p,{children:["\u53ea\u9700\u8981\u6784\u9020SSL\u7ed3\u6784\u4f53\uff0c\u4f7f\u5f97\u6ee1\u8db3\u6761\u4ef6\uff0c\u6700\u7ec8\u8c03\u7528",(0,c.jsx)(s.code,{children:"s->handshake_func(s)"}),"\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0rip\u52ab\u6301\uff0c\u628arip\u52ab\u6301\u52300xdeadbeef\u5982\u56fe\uff1a"]}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.img,{src:n(72791).A+"",width:"1283",height:"507"})}),"\n",(0,c.jsx)(s.h3,{id:"36-rop",children:"3.6 ROP"}),"\n",(0,c.jsx)(s.p,{children:"FortiGate\u4e3b\u7a0b\u5e8f\u662f\u4e00\u4e2aAll in One\u7684\u4e8c\u8fdb\u5236\uff0c\u5927\u5c0f\u5df2\u8d85\u8fc770MB\uff0c\u6709\u5927\u91cf\u7684gadget\u53ef\u4ee5\u5229\u7528\uff0c\u5229\u7528ROP\u5b9e\u73b0RCE\u5e76\u4e0d\u56f0\u96be\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002"}),"\n",(0,c.jsx)(s.h2,{id:"\u56db\u5229\u7528\u6f14\u793a",children:"\u56db\u3001\u5229\u7528\u6f14\u793a"}),"\n",(0,c.jsx)(s.p,{children:"\u5c3d\u7ba17.4.2\u7248\u672cSSL VPN\u9ed8\u8ba4\u5df2\u5173\u95edweb mode\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u8fd4\u56de403\uff0c\u4f46\u662f\u8be5\u6f0f\u6d1e\u4ecd\u7136\u53ef\u4ee5\u5728\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u5b8c\u6210\u5229\u7528\u3002"}),"\n",(0,c.jsx)(s.p,{children:(0,c.jsx)(s.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(75652).A+"",children:"cve-2024-21762.mp4 1920x1080"})}),"\n",(0,c.jsx)(s.h2,{id:"\u4e94\u603b\u7ed3",children:"\u4e94\u3001\u603b\u7ed3"}),"\n",(0,c.jsxs)(s.p,{children:["\u8be5\u6f0f\u6d1e\u4e0e\u53bb\u5e74\u7684",(0,c.jsx)(s.code,{children:"CVE-2023-27997"}),"XOR\u5bfc\u81f4\u7684\u5806\u6ea2\u51fa\u6f0f\u6d1e\u7c7b\u4f3c\uff0c\u90fd\u662f\u770b\u8d77\u6765\u6bd4\u8f83\u9e21\u808b\u7684\u6ea2\u51fa\u6f0f\u6d1e\uff0c\u5229\u7528\u8fc7\u7a0b\u6bd4\u8f83Trick\uff0c\u66f4\u50cf\u662f\u4e00\u9053CTF\u9898\u76ee\u3002\u4f46\u662f\u4e0e\u4f20\u7edf\u653b\u51fb\u5806\u7ba1\u7406\u5668\u7684CTF\u9898\u76ee\u76f8\u6bd4\uff0c\u771f\u5b9e\u6f0f\u6d1e\u66f4\u591a\u7684\u9700\u8981\u501f\u52a9\u4e0a\u4e0b\u6587\u7684\u7ed3\u6784\u4f53\u548c\u4ee3\u7801\u903b\u8f91\u5b8c\u6210\u5229\u7528\u3002\u7b14\u8005\u6c34\u5e73\u6709\u9650\uff0c\u5982\u6709\u7eb0\u6f0f\uff0c\u6b22\u8fce\u6307\u6b63\u3002"]})]})}function o(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}},75652:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/files/ea0543c3-963a-4213-b48c-140a4bd46be9-b43413449c565ce0732b3e379a3a48c0.mp4"},59133:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/04b4cd7f-26a7-4edf-9170-5877a4faf85c-94377426a6766b3e5062f9372e8a86d2.png"},57022:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/08b6ccf8-ebc5-4f99-9ba1-22878906ed2a-b7413aaa8afd0151ad9a770be566d21f.png"},6537:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/1858556a-64dd-4580-83e5-f18716e53675-81c895d3f77edec18988662f3fe963d3.png"},46386:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/4bd85c58-3d36-4e25-ae9a-4da3a37bb345-d8ea67c849ca9aecd98b433f7b16b4f4.png"},24116:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/5370cb70-0aea-4f0f-b030-f064d66d1e96-c71f1f37f39323a10264c36f6fda04d0.png"},31642:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/5fa4e3f7-68fe-4c97-a28b-9416d587ca5c-0d8e9c8e2f6d1b435903d6efc2920f72.png"},52429:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/6bdb4e46-ab48-410b-942d-feb7ab8a9468-0481067f848fe3802e27eb9d5481b1a1.png"},79945:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/78e4d666-bde7-41bf-a381-fb43d0ab59fc-37dea9956243c26dea895b655d62ef03.png"},29980:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/7a2dc0e8-aa9f-4602-939a-4bd887f60af9-0402c9dc23ca6085a92e20b905b0e243.png"},89871:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/832428aa-0e00-4304-8746-ad76f5b89f49-edcef5964fd3d3c3adf8ae33cdd2ab7e.png"},72791:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/8ee4d24b-c6bf-406c-b760-9158b0e56d2a-24ae5943089e4899e2aea04ecea48848.png"},54620:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/9aee4f58-faaf-4149-95c8-2e0021765428-b05963211233db3159c4b58315f0d7a8.png"},77991:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/b70c38cc-2f67-41ea-a8ad-5171db378f60-f5fe88d74bcda4926b35f4e0b580d73e.png"},48289:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/bb4591c2-c265-465b-a297-355ffdd71ca6-f4ab02090099db9342af5244b3831380.png"},85382:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/c66a0187-d618-4812-ae16-71360387dcad-4f4e5a8437cd7c3e4c7a88774058ea97.png"},41841:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/dab807ff-e94c-4042-8f60-3e0ace738a7c-1b49595795399f4a7c2cdb9d3620b108.png"},56796:(e,s,n)=>{n.d(s,{A:()=>c});const c=n.p+"assets/images/fc05a1d1-3f31-4880-8cd4-f8b0f7b09090-5d55821ef1d689fb01c6c1c8e480b556.png"},28453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>r});var c=n(96540);const d={},i=c.createContext(d);function a(e){const s=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),c.createElement(i.Provider,{value:s},e.children)}}}]);